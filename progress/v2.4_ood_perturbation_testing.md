# v2.4 — OOD Perturbation Testing (Table 3)

**Date:** 2026-02-28
**Goal:** Test decomposed vs multi-sample under pure epistemic (OOD) perturbations.

## Results — Table 3: OOD Perturbation Evaluation (HIGH noise, 100 episodes each)

| Scenario | Perturbation | Vanilla | Multi-Sample | **Decomposed** | Delta(D-MS) |
|---|---|---|---|---|---|
| E3_mass_2x | Object 2x heavier | 52.0% | 98.0% | **97.0%** | -1.0% |
| **E3_mass_5x** | Object 5x heavier | 38.0% | 75.0% | **84.0%** | **+9.0%** |
| E3_mass_10x | Object 10x heavier | 0.0% | 17.0% | 14.0% | -3.0% |
| E4_friction_0.5 | Friction halved | 52.0% | 96.9% | 90.6% | -6.2% |
| E4_friction_0.2 | Friction 0.2x | 47.0% | 96.1% | 91.4% | -4.7% |
| E6_gravity_1.5 | Gravity 1.5x | 59.0% | 96.1% | **96.1%** | +0.0% |

## Intervention Breakdown by Scenario

| Scenario | NORMAL | FILTER | CONSERVATIVE | BOTH |
|---|---|---|---|---|
| E3_mass_2x | 0.0% | 88.6% | 0.0% | 11.4% |
| E3_mass_5x | 0.0% | 70.8% | 0.0% | 29.2% |
| E3_mass_10x | 0.0% | 65.9% | 0.0% | 34.1% |
| E4_friction_0.5 | 0.0% | 86.5% | 0.0% | 13.5% |
| E4_friction_0.2 | 0.0% | 85.1% | 0.0% | 14.9% |
| E6_gravity_1.5 | 0.0% | 91.6% | 0.0% | 8.4% |

## Reward Comparison

| Scenario | Vanilla | Multi-Sample | Decomposed |
|---|---|---|---|
| E3_mass_2x | 24.90 | 100.57 | 105.20 |
| E3_mass_5x | 11.33 | 36.50 | 41.41 |
| E3_mass_10x | 5.14 | 11.37 | 11.41 |
| E4_friction_0.5 | 34.17 | 114.30 | 107.81 |
| E4_friction_0.2 | -1.81 | 101.18 | 89.84 |
| E6_gravity_1.5 | 13.72 | 102.95 | 104.59 |

## Key Findings

1. **Mass 5x: Decomposed BEATS multi-sample by +9.0% success and +13.5% reward** — the main paper claim
2. **Gravity 1.5x: Tied at 96.1%** — decomposed has higher reward (104.59 vs 102.95)
3. **Mass 2x: Near-tied** — both ~97-98%, decomposed has higher reward (105.20 vs 100.57)
4. **Mass 10x: Both struggle** — perturbation too extreme, robot physically can't lift 10x mass
5. **Friction scenarios: Multi-sample outperforms decomposed by ~5-6%** — conservative scaling slightly hurts on friction OOD because the dynamics change doesn't create strong enough Mahalanobis signal to outweigh the action scaling cost
6. **Conservative scaling increases with perturbation severity**: mass 2x→5x→10x shows 11.4%→29.2%→34.1% BOTH interventions

## Analysis

The decomposed method shines when:
- The OOD perturbation creates a detectable Mahalanobis distance shift (mass changes affect object dynamics → different joint states)
- The perturbation is in the "sweet spot" — severe enough for conservative scaling to help, not so extreme that the task is physically impossible

The friction results suggest that friction changes may not shift the observation distribution enough for Mahalanobis to detect them (friction affects contact forces, not directly the observed joint/object states). This is an honest limitation worth noting in the paper.

## Technical Notes

- Used **single environment** with PhysX property restoration between scenarios (vs 6 separate `gym.make()` calls)
- PhysX API requires `torch.int32` CPU indices for `set_masses()` and `set_material_properties()`
- Gravity API: `SimulationContext.instance().physics_sim_view.set_gravity(carb.Float3(*gravity))`
- Results are deterministic (seed=42)

## Parameters
```
tau_a=0.3, tau_e=0.7, beta=0.3, N=5, 100 episodes per scenario, seed=42
noise_level=high (joint_pos_std=0.02, joint_vel_std=0.1, object_pos_std=0.10)
```

## Result Files
- `results/ood_high_20260228_213801/ood_results.json`

## Paper Value
- **Table 3**: OOD perturbation comparison — decomposed beats multi-sample at mass 5x (+9.0%)
- **Key claim**: Conservative scaling from epistemic detection provides real benefit under strong OOD
- **Honest limitation**: Friction OOD not well-detected by Mahalanobis (doesn't shift obs distribution enough)
